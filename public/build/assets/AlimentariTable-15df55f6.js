import{P as B,d as T,f as u,i as c,j as e,l as S,F as k,x as K,C as p,D as m,Q as _,R as o,p as h,u as b,t as j}from"./app-a006bb0d.js";const N={class:"table-responsive"},E={class:"table table-sm alimentari-table align-middle"},U=e("thead",null,[e("tr",null,[e("th",null,"Dată / oră alimentare"),e("th",{class:"text-end"},"Litrii"),e("th",{class:"text-end"},"Preț / litru"),e("th",{class:"text-end"},"Total preț"),e("th",{class:"actions-column text-center"},"Acțiuni")])],-1),D={key:0},C=e("td",{colspan:"5",class:"text-center py-4"},"Nu există alimentări salvate.",-1),F=[C],A={class:"fw-semibold"},P={class:"d-flex align-items-center gap-2"},L=["onUpdate:modelValue","onBlur","onKeydown","aria-label"],O={class:"text-muted"},q={class:"text-end"},M={class:"d-flex justify-content-end align-items-center gap-2"},R=["onUpdate:modelValue","onBlur","onKeydown","aria-label"],H={class:"text-end"},J={class:"d-flex justify-content-end align-items-center gap-2"},Q=["onUpdate:modelValue","onBlur","onKeydown","aria-label"],X={class:"text-end"},z={class:"d-flex justify-content-end align-items-center gap-2"},G=["onUpdate:modelValue","onBlur","onKeydown","aria-label"],I={class:"text-center"},W={class:"d-flex justify-content-center flex-wrap alimentari-actions"},Y=["data-bs-target"],Z=e("i",{class:"fa-solid fa-pen-to-square me-1"},null,-1),w=[Z],tt=["action"],et=["value"],st=e("input",{type:"hidden",name:"_method",value:"DELETE"},null,-1),at=e("button",{type:"submit",class:"btn btn-sm btn-outline-danger border border-dark"},[e("i",{class:"fa-solid fa-trash me-1"})],-1),lt={__name:"AlimentariTable",props:{rows:{type:Array,default:()=>[]},csrfToken:{type:String,required:!0}},setup(v){const f=v,g=["data_ora_alimentare","litrii","pret_pe_litru","total_pret"],y=B(f.rows.map(a=>({...a,values:{...a.values},displayValues:{...a.display_values},editValues:{...a.values},statuses:g.reduce((s,t)=>(s[t]={status:null,message:""},s),{})}))),r=T({name:"StatusBadge",props:{state:{type:Object,required:!0}},template:`
        <span v-if="state.status === 'saved'" class="text-success small">✓</span>
        <span v-else-if="state.status === 'saving'" class="text-muted small">...</span>
        <span v-else-if="state.status === 'error'" class="text-danger small" :title="state.message">⚠</span>
    `}),V=(a,s=2)=>{if(a==null||a==="")return"";const t=Number(a).toFixed(s).replace(/\.0+$/,"").replace(/\.([0-9]*?)0+$/,".$1");return t==="-0"?"0":t},l=(a,s)=>{const t=y.find(d=>d.id===a);if(!t||!g.includes(s))return;const n=t.editValues[s],i=t.values[s];`${n}`!=`${i}`&&x(t,s,n)},x=async(a,s,t)=>{a.statuses[s]={status:"saving",message:""};try{const n=await fetch(a.update_url,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":f.csrfToken},body:JSON.stringify({field:s,value:t})}),i=await n.json();if(!n.ok||i.status!=="success")throw new Error(i.message||"Nu am putut salva câmpul.");const d=i.value??t;a.values[s]=d,a.editValues[s]=d,a.displayValues[s]=i.displayValue??a.displayValues[s],["litrii","pret_pe_litru","total_pret"].includes(s)&&(a.editValues[s]=V(t,s==="litrii"?2:4)),a.statuses[s]={status:"saved",message:"Salvat"},setTimeout(()=>{a.statuses[s]={status:null,message:""}},1500)}catch(n){a.editValues[s]=a.values[s],a.statuses[s]={status:"error",message:n.message}}},$=a=>{var t;const s=((t=a.target)==null?void 0:t.closest("form"))??a.target;s&&typeof s.submit=="function"&&confirm("Sigur ștergi această alimentare?")&&s.submit()};return(a,s)=>(u(),c("div",N,[e("table",E,[U,e("tbody",null,[y.length?S("",!0):(u(),c("tr",D,F)),(u(!0),c(k,null,K(y,t=>(u(),c("tr",{key:t.id},[e("td",A,[e("div",P,[p(e("input",{type:"datetime-local",class:"form-control form-control-sm","onUpdate:modelValue":n=>t.editValues.data_ora_alimentare=n,onBlur:n=>l(t.id,"data_ora_alimentare"),onKeydown:_(o(n=>l(t.id,"data_ora_alimentare"),["prevent"]),["enter"]),"aria-label":`Data alimentare pentru rândul ${t.id}`},null,40,L),[[m,t.editValues.data_ora_alimentare]]),h(b(r),{state:t.statuses.data_ora_alimentare},null,8,["state"])]),e("small",O,j(t.displayValues.data_ora_alimentare),1)]),e("td",q,[e("div",M,[p(e("input",{type:"number",step:"0.01",min:"0",class:"form-control form-control-sm text-end","onUpdate:modelValue":n=>t.editValues.litrii=n,onBlur:n=>l(t.id,"litrii"),onKeydown:_(o(n=>l(t.id,"litrii"),["prevent"]),["enter"]),"aria-label":`Litrii pentru rândul ${t.id}`},null,40,R),[[m,t.editValues.litrii]]),h(b(r),{state:t.statuses.litrii},null,8,["state"])])]),e("td",H,[e("div",J,[p(e("input",{type:"number",step:"0.0001",min:"0",class:"form-control form-control-sm text-end","onUpdate:modelValue":n=>t.editValues.pret_pe_litru=n,onBlur:n=>l(t.id,"pret_pe_litru"),onKeydown:_(o(n=>l(t.id,"pret_pe_litru"),["prevent"]),["enter"]),"aria-label":`Preț pe litru pentru rândul ${t.id}`},null,40,Q),[[m,t.editValues.pret_pe_litru]]),h(b(r),{state:t.statuses.pret_pe_litru},null,8,["state"])])]),e("td",X,[e("div",z,[p(e("input",{type:"number",step:"0.0001",min:"0",class:"form-control form-control-sm text-end","onUpdate:modelValue":n=>t.editValues.total_pret=n,onBlur:n=>l(t.id,"total_pret"),onKeydown:_(o(n=>l(t.id,"total_pret"),["prevent"]),["enter"]),"aria-label":`Total preț pentru rândul ${t.id}`},null,40,G),[[m,t.editValues.total_pret]]),h(b(r),{state:t.statuses.total_pret},null,8,["state"])])]),e("td",I,[e("div",W,[e("button",{class:"btn btn-sm btn-outline-primary border border-dark",type:"button","data-bs-toggle":"modal","data-bs-target":`#alimentareEditModal-${t.id}`},w,8,Y),e("form",{method:"POST",action:t.delete_url,class:"d-inline",onSubmit:s[0]||(s[0]=o(n=>$(n),["prevent"]))},[e("input",{type:"hidden",name:"_token",value:v.csrfToken},null,8,et),st,at],40,tt)])])]))),128))])])]))}};export{lt as default};
