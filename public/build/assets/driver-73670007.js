import{o,a as c,b as n,F as N,r as B,n as nt,t as m,e as U,f as x,g as rt,w as Z,h,i as G,j as A,k as q,u as C,l as lt,m as R,p as I,v as D,q as P,s as st,x as ot,c as ct}from"./vue.esm-bundler-ea606579.js";const dt={class:"d-flex justify-content-between align-items-center mb-3"},ut=n("h2",{class:"fs-5 mb-0"},"Valabilitățile mele",-1),_t=["disabled"],mt=n("i",{class:"fa-solid fa-rotate"},null,-1),ft=n("span",{class:"ms-1"},"Actualizează",-1),vt=[mt,ft],bt={key:0,class:"text-center py-5"},pt=n("div",{class:"spinner-border text-primary",role:"status"},[n("span",{class:"visually-hidden"},"Încărcare...")],-1),gt=[pt],yt={key:1,class:"alert alert-light border rounded-4",role:"status"},ht={key:2,class:"driver-scroll pe-1"},$t=["onClick"],kt={class:"d-flex justify-content-between align-items-start flex-wrap gap-2"},xt={class:"d-block fw-semibold"},wt={class:"text-muted small"},St={class:"badge bg-primary rounded-pill px-3 py-2"},Tt={class:"mt-3 text-muted small"},jt={__name:"ValabilitateList",props:{valabilitati:{type:Array,default:()=>[]},selectedId:{type:Number,default:null},loading:{type:Boolean,default:!1}},setup(t){function s(u){const a=u.data_inceput?new Date(u.data_inceput):null,l=u.data_sfarsit?new Date(u.data_sfarsit):null,f={year:"numeric",month:"short",day:"numeric"};return a&&l?`${a.toLocaleDateString(void 0,f)} – ${l.toLocaleDateString(void 0,f)}`:a?`Din ${a.toLocaleDateString(void 0,f)}`:l?`Până la ${l.toLocaleDateString(void 0,f)}`:"Interval necunoscut"}return(u,a)=>(o(),c("div",null,[n("div",dt,[ut,n("button",{class:"btn btn-sm btn-outline-primary",type:"button",onClick:a[0]||(a[0]=l=>u.$emit("refresh")),disabled:t.loading},vt,8,_t)]),t.loading?(o(),c("div",bt,gt)):t.valabilitati.length===0?(o(),c("div",yt," Nu există valabilități active alocate utilizatorului curent. ")):(o(),c("div",ht,[(o(!0),c(N,null,B(t.valabilitati,l=>(o(),c("button",{key:l.id,type:"button",class:nt(["driver-card-button w-100 text-start p-4 mb-3",{active:l.id===t.selectedId}]),onClick:f=>u.$emit("select",l.id)},[n("div",kt,[n("div",null,[n("span",xt,m(l.denumire),1),n("span",wt,m(l.numar_auto),1)]),n("span",St,m(l.curse_count)+" "+m(l.curse_count===1?"cursă":"curse"),1)]),n("div",Tt,m(s(l)),1)],10,$t))),128))]))]))}};function It(t){var s=typeof t;return t!=null&&(s=="object"||s=="function")}var tt=It,Ot=typeof U=="object"&&U&&U.Object===Object&&U,Vt=Ot,Et=Vt,Ct=typeof self=="object"&&self&&self.Object===Object&&self,Dt=Et||Ct||Function("return this")(),et=Dt,Nt=et,Lt=function(){return Nt.Date.now()},At=Lt,Ft=/\s/;function Bt(t){for(var s=t.length;s--&&Ft.test(t.charAt(s)););return s}var Ut=Bt,zt=Ut,Mt=/^\s+/;function qt(t){return t&&t.slice(0,zt(t)+1).replace(Mt,"")}var Rt=qt,Gt=et,Pt=Gt.Symbol,at=Pt,W=at,it=Object.prototype,Wt=it.hasOwnProperty,Jt=it.toString,F=W?W.toStringTag:void 0;function Ht(t){var s=Wt.call(t,F),u=t[F];try{t[F]=void 0;var a=!0}catch{}var l=Jt.call(t);return a&&(s?t[F]=u:delete t[F]),l}var Kt=Ht,Xt=Object.prototype,Qt=Xt.toString;function Yt(t){return Qt.call(t)}var Zt=Yt,J=at,te=Kt,ee=Zt,ae="[object Null]",ie="[object Undefined]",H=J?J.toStringTag:void 0;function ne(t){return t==null?t===void 0?ie:ae:H&&H in Object(t)?te(t):ee(t)}var re=ne;function le(t){return t!=null&&typeof t=="object"}var se=le,oe=re,ce=se,de="[object Symbol]";function ue(t){return typeof t=="symbol"||ce(t)&&oe(t)==de}var _e=ue,me=Rt,K=tt,fe=_e,X=0/0,ve=/^[-+]0x[0-9a-f]+$/i,be=/^0b[01]+$/i,pe=/^0o[0-7]+$/i,ge=parseInt;function ye(t){if(typeof t=="number")return t;if(fe(t))return X;if(K(t)){var s=typeof t.valueOf=="function"?t.valueOf():t;t=K(s)?s+"":s}if(typeof t!="string")return t===0?t:+t;t=me(t);var u=be.test(t);return u||pe.test(t)?ge(t.slice(2),u?2:8):ve.test(t)?X:+t}var he=ye,$e=tt,M=At,Q=he,ke="Expected a function",xe=Math.max,we=Math.min;function Se(t,s,u){var a,l,f,b,v,p,k=0,S=!1,g=!1,$=!0;if(typeof t!="function")throw new TypeError(ke);s=Q(s)||0,$e(u)&&(S=!!u.leading,g="maxWait"in u,f=g?xe(Q(u.maxWait)||0,s):f,$="trailing"in u?!!u.trailing:$);function y(e){var i=a,T=l;return a=l=void 0,k=e,b=t.apply(T,i),b}function O(e){return k=e,v=setTimeout(j,s),S?y(e):b}function L(e){var i=e-p,T=e-k,z=s-i;return g?we(z,f-T):z}function V(e){var i=e-p,T=e-k;return p===void 0||i>=s||i<0||g&&T>=f}function j(){var e=M();if(V(e))return E(e);v=setTimeout(j,L(e))}function E(e){return v=void 0,$&&a?y(e):(a=l=void 0,b)}function d(){v!==void 0&&clearTimeout(v),k=0,a=p=l=v=void 0}function _(){return v===void 0?b:E(M())}function r(){var e=M(),i=V(e);if(a=arguments,l=this,p=e,i){if(v===void 0)return O(p);if(g)return clearTimeout(v),v=setTimeout(j,s),y(p)}return v===void 0&&(v=setTimeout(j,s)),b}return r.cancel=d,r.flush=_,r}var Te=Se;const je={class:"driver-autocomplete"},Ie=["for"],Oe=["id","placeholder","value","disabled"],Ve={key:0,class:"driver-autocomplete__list mt-1"},Ee=["onMousedown"],Ce={key:0,class:"px-3 py-2 text-muted small"},Y={__name:"LocalitateAutocomplete",props:{modelValue:{type:String,default:""},label:{type:String,required:!0},endpoint:{type:String,required:!0},id:{type:String,required:!0},placeholder:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:s}){const u=t,a=x([]),l=x(!1);let f=!0;const b=Te(async g=>{var $;if(!g||g.trim().length<2){a.value=[];return}try{const y=await window.axios.get(u.endpoint,{params:{term:g}});if(!f)return;a.value=(($=y==null?void 0:y.data)==null?void 0:$.localitati)??[]}catch(y){console.error("Autocomplete localitate",y),a.value=[]}},200);rt(()=>{f=!1});function v(g){const $=g.target.value;s("update:modelValue",$),b($)}function p(g){l.value=!0,b(g.target.value)}function k(){setTimeout(()=>{l.value=!1},120)}function S(g){s("update:modelValue",g),l.value=!1}return(g,$)=>(o(),c("div",je,[n("label",{for:t.id,class:"form-label"},m(t.label),9,Ie),n("input",{id:t.id,type:"text",class:"form-control",placeholder:t.placeholder,value:t.modelValue,disabled:t.disabled,onInput:v,onFocus:p,onBlur:k,autocomplete:"off"},null,40,Oe),l.value?(o(),c("div",Ve,[(o(!0),c(N,null,B(a.value,y=>(o(),c("button",{key:y,type:"button",class:"driver-autocomplete__item w-100 text-start bg-transparent border-0",onMousedown:Z(O=>S(y),["prevent"])},m(y),41,Ee))),128)),a.value.length===0?(o(),c("div",Ce,' Nu am găsit rezultate pentru "'+m(t.modelValue)+'". ',1)):h("",!0)])):h("",!0)]))}},De={class:"driver-form-section p-4"},Ne={class:"d-flex justify-content-between align-items-start flex-wrap gap-3"},Le={class:"fs-4 mb-1"},Ae={class:"text-muted mb-0"},Fe=n("i",{class:"fa-solid fa-circle-plus me-2"},null,-1),Be={key:0,class:"text-center py-5"},Ue=n("div",{class:"spinner-border text-primary",role:"status"},[n("span",{class:"visually-hidden"},"Încărcare...")],-1),ze=[Ue],Me={key:0,class:"mt-4"},qe={class:"d-flex justify-content-between align-items-center mb-3"},Re={class:"fs-5 mb-0"},Ge={key:0,class:"alert alert-danger",role:"alert"},Pe=["onSubmit"],We={class:"col-12 col-md-6"},Je={key:0,class:"text-danger small mt-1"},He={class:"col-12 col-md-6"},Ke=n("label",{for:"incarcare_cod_postal",class:"form-label"},"Cod poștal încărcare",-1),Xe=["disabled"],Qe={key:0,class:"text-danger small mt-1"},Ye={class:"col-12 col-md-6"},Ze=n("label",{for:"incarcare_tara_id",class:"form-label"},"Țară încărcare",-1),ta=["disabled"],ea=n("option",{value:""},"Alegeți țara",-1),aa=["value"],ia={key:0,class:"text-danger small mt-1"},na={class:"col-12 col-md-6"},ra={key:0,class:"text-danger small mt-1"},la={class:"col-12 col-md-6"},sa=n("label",{for:"descarcare_cod_postal",class:"form-label"},"Cod poștal descărcare",-1),oa=["disabled"],ca={key:0,class:"text-danger small mt-1"},da={class:"col-12 col-md-6"},ua=n("label",{for:"descarcare_tara_id",class:"form-label"},"Țară descărcare",-1),_a=["disabled"],ma=n("option",{value:""},"Alegeți țara",-1),fa=["value"],va={key:0,class:"text-danger small mt-1"},ba={class:"col-12 col-md-6"},pa=n("label",{for:"data_cursa_date",class:"form-label"},"Data cursei",-1),ga=["disabled"],ya={key:0,class:"text-danger small mt-1"},ha={key:0,class:"col-12 col-md-6"},$a=n("label",{for:"data_cursa_time",class:"form-label"},"Ora cursei",-1),ka=["disabled"],xa={key:0,class:"text-danger small mt-1"},wa={key:1,class:"col-12"},Sa={class:"col-12"},Ta=n("label",{for:"observatii",class:"form-label"},"Observații",-1),ja=["disabled"],Ia={key:0,class:"text-danger small mt-1"},Oa={class:"col-12 col-md-6"},Va=n("label",{for:"km_bord",class:"form-label"},"KM bord",-1),Ea=["disabled"],Ca={key:0,class:"text-danger small mt-1"},Da={class:"col-12 d-flex gap-3 flex-wrap"},Na=["disabled"],La=["disabled"],Aa={class:"mt-5"},Fa={class:"d-flex justify-content-between align-items-center mb-3"},Ba=n("h3",{class:"fs-5 mb-0"},"Curse înregistrate",-1),Ua={key:0,class:"d-flex flex-column gap-3"},za={class:"d-flex justify-content-between align-items-start flex-wrap gap-2"},Ma={class:"fw-semibold mb-1"},qa={class:"mb-0 text-muted small"},Ra={class:"d-flex flex-column gap-2"},Ga=["onClick"],Pa=["onClick"],Wa={key:0,class:"mt-3 text-muted"},Ja={key:1,class:"alert alert-light border rounded-4"},Ha={__name:"ValabilitateDetail",props:{valabilitate:{type:Object,required:!0},countries:{type:Array,default:()=>[]},romaniaId:{type:[Number,null],default:null},loading:{type:Boolean,default:!1},saving:{type:Boolean,default:!1},createCursa:{type:Function,required:!0},updateCursa:{type:Function,required:!0},deleteCursa:{type:Function,required:!0},localitatiEndpoint:{type:String,required:!0}},setup(t){const s=t,u=x(null),a=G($()),l=G({}),f=x(""),b=x(!1),v=A(()=>u.value!==null),p=A(()=>u.value==="edit"?"Editează cursa":"Adaugă cursă"),k=A(()=>{const r=s.valabilitate.data_inceput?new Date(s.valabilitate.data_inceput):null,e=s.valabilitate.data_sfarsit?new Date(s.valabilitate.data_sfarsit):null,i={year:"numeric",month:"long",day:"numeric"};return r&&e?`${r.toLocaleDateString(void 0,i)} – ${e.toLocaleDateString(void 0,i)}`:r?`Din ${r.toLocaleDateString(void 0,i)}`:e?`Până la ${e.toLocaleDateString(void 0,i)}`:"Interval necunoscut"}),S=A(()=>{if(!v.value)return!1;const r=a.descarcare_tara_id?parseInt(a.descarcare_tara_id,10):null;return s.romaniaId!==null&&r===s.romaniaId?!0:u.value==="create"?!(s.valabilitate.has_curse??!1):u.value==="edit"?s.valabilitate.first_cursa_id===a.id:!1}),g=A(()=>S.value||b.value||!!a.data_cursa_time);q(()=>s.valabilitate,()=>{y()},{deep:!0}),q(()=>a.descarcare_tara_id,(r,e)=>{if(!r||s.romaniaId===null)return;const i=parseInt(r,10),T=e?parseInt(e,10):null;i===s.romaniaId&&T!==s.romaniaId&&(window.confirm("Descărcarea în România necesită completarea orei. Continuați?")||(a.descarcare_tara_id=e??""))});function $(){return{id:null,incarcare_localitate:"",incarcare_cod_postal:"",incarcare_tara_id:"",descarcare_localitate:"",descarcare_cod_postal:"",descarcare_tara_id:"",data_cursa_date:"",data_cursa_time:"",observatii:"",km_bord:""}}function y(){Object.assign(a,$()),Object.keys(l).forEach(r=>delete l[r]),f.value="",u.value=null,b.value=!1}function O(){y(),u.value="create"}function L(r){y(),u.value="edit",a.id=r.id,a.incarcare_localitate=r.incarcare_localitate??"",a.incarcare_cod_postal=r.incarcare_cod_postal??"",a.incarcare_tara_id=r.incarcare_tara_id?String(r.incarcare_tara_id):"",a.descarcare_localitate=r.descarcare_localitate??"",a.descarcare_cod_postal=r.descarcare_cod_postal??"",a.descarcare_tara_id=r.descarcare_tara_id?String(r.descarcare_tara_id):"",a.data_cursa_date=r.data_date??"",a.data_cursa_time=r.data_time??"",a.observatii=r.observatii??"",a.km_bord=r.km_bord??"",b.value=!!a.data_cursa_time}function V(){y()}function j(r){return l[r]?l[r][0]:l.data_cursa?l.data_cursa[0]:null}async function E(){Object.keys(l).forEach(e=>delete l[e]),f.value="";const r={incarcare_localitate:a.incarcare_localitate,incarcare_cod_postal:a.incarcare_cod_postal,incarcare_tara_id:a.incarcare_tara_id||null,descarcare_localitate:a.descarcare_localitate,descarcare_cod_postal:a.descarcare_cod_postal,descarcare_tara_id:a.descarcare_tara_id||null,data_cursa_date:a.data_cursa_date||null,data_cursa_time:g.value&&a.data_cursa_time||null,observatii:a.observatii,km_bord:a.km_bord===""?null:a.km_bord};try{u.value==="edit"?await s.updateCursa(a.id,r):await s.createCursa(r),y()}catch(e){(e==null?void 0:e.type)==="validation"?(Object.assign(l,e.errors??{}),f.value="Verificați câmpurile marcate și încercați din nou."):(f.value="A apărut o eroare neașteptată. Încercați mai târziu.",console.error(e))}}async function d(r){if(window.confirm("Sigur doriți să ștergeți această cursă?"))try{await s.deleteCursa(r.id)}catch(i){console.error(i),f.value="Cursa nu a putut fi ștearsă. Încercați din nou."}}function _(r){if(!r.data_date)return"Dată necompletată";const e=new Date(`${r.data_date}T${r.data_time??"00:00"}`),i={year:"numeric",month:"short",day:"numeric"};return r.data_time?`${e.toLocaleDateString(void 0,i)} · ${r.data_time}`:e.toLocaleDateString(void 0,i)}return(r,e)=>(o(),c("div",De,[n("div",Ne,[n("div",null,[n("h2",Le,m(t.valabilitate.denumire),1),n("p",Ae,m(t.valabilitate.numar_auto)+" · "+m(C(k)),1)]),C(v)?h("",!0):(o(),c("button",{key:0,type:"button",class:"btn btn-primary btn-lg",onClick:O},[Fe,lt(" Adaugă cursă ")]))]),t.loading?(o(),c("div",Be,ze)):(o(),c(N,{key:1},[C(v)?(o(),c("section",Me,[n("div",qe,[n("h3",Re,m(C(p)),1),n("button",{type:"button",class:"btn btn-link text-decoration-none",onClick:V}," Renunță ")]),f.value?(o(),c("div",Ge,m(f.value),1)):h("",!0),n("form",{class:"row g-3",onSubmit:Z(E,["prevent"])},[n("div",We,[R(Y,{id:"incarcare-localitate",label:"Localitate încărcare",endpoint:t.localitatiEndpoint,modelValue:a.incarcare_localitate,"onUpdate:modelValue":e[0]||(e[0]=i=>a.incarcare_localitate=i),disabled:t.saving},null,8,["endpoint","modelValue","disabled"]),l.incarcare_localitate?(o(),c("div",Je,m(l.incarcare_localitate[0]),1)):h("",!0)]),n("div",He,[Ke,I(n("input",{id:"incarcare_cod_postal",type:"text",class:"form-control","onUpdate:modelValue":e[1]||(e[1]=i=>a.incarcare_cod_postal=i),disabled:t.saving},null,8,Xe),[[D,a.incarcare_cod_postal]]),l.incarcare_cod_postal?(o(),c("div",Qe,m(l.incarcare_cod_postal[0]),1)):h("",!0)]),n("div",Ye,[Ze,I(n("select",{id:"incarcare_tara_id",class:"form-select","onUpdate:modelValue":e[2]||(e[2]=i=>a.incarcare_tara_id=i),disabled:t.saving},[ea,(o(!0),c(N,null,B(t.countries,i=>(o(),c("option",{key:i.id,value:String(i.id)},m(i.nume),9,aa))),128))],8,ta),[[P,a.incarcare_tara_id]]),l.incarcare_tara_id?(o(),c("div",ia,m(l.incarcare_tara_id[0]),1)):h("",!0)]),n("div",na,[R(Y,{id:"descarcare-localitate",label:"Localitate descărcare",endpoint:t.localitatiEndpoint,modelValue:a.descarcare_localitate,"onUpdate:modelValue":e[3]||(e[3]=i=>a.descarcare_localitate=i),disabled:t.saving},null,8,["endpoint","modelValue","disabled"]),l.descarcare_localitate?(o(),c("div",ra,m(l.descarcare_localitate[0]),1)):h("",!0)]),n("div",la,[sa,I(n("input",{id:"descarcare_cod_postal",type:"text",class:"form-control","onUpdate:modelValue":e[4]||(e[4]=i=>a.descarcare_cod_postal=i),disabled:t.saving},null,8,oa),[[D,a.descarcare_cod_postal]]),l.descarcare_cod_postal?(o(),c("div",ca,m(l.descarcare_cod_postal[0]),1)):h("",!0)]),n("div",da,[ua,I(n("select",{id:"descarcare_tara_id",class:"form-select","onUpdate:modelValue":e[5]||(e[5]=i=>a.descarcare_tara_id=i),disabled:t.saving},[ma,(o(!0),c(N,null,B(t.countries,i=>(o(),c("option",{key:i.id,value:String(i.id)},m(i.nume),9,fa))),128))],8,_a),[[P,a.descarcare_tara_id]]),l.descarcare_tara_id?(o(),c("div",va,m(l.descarcare_tara_id[0]),1)):h("",!0)]),n("div",ba,[pa,I(n("input",{id:"data_cursa_date",type:"date",class:"form-control","onUpdate:modelValue":e[6]||(e[6]=i=>a.data_cursa_date=i),disabled:t.saving},null,8,ga),[[D,a.data_cursa_date]]),l.data_cursa||l.data_cursa_date?(o(),c("div",ya,m(j("data_cursa_date")),1)):h("",!0)]),C(g)?(o(),c("div",ha,[$a,I(n("input",{id:"data_cursa_time",type:"time",class:"form-control","onUpdate:modelValue":e[7]||(e[7]=i=>a.data_cursa_time=i),disabled:t.saving},null,8,ka),[[D,a.data_cursa_time]]),l.data_cursa_time?(o(),c("div",xa,m(l.data_cursa_time[0]),1)):h("",!0)])):(o(),c("div",wa,[n("button",{type:"button",class:"btn btn-outline-secondary w-100",onClick:e[8]||(e[8]=i=>b.value=!0)}," Adaugă ora cursei (opțional) ")])),n("div",Sa,[Ta,I(n("textarea",{id:"observatii",class:"form-control",rows:"3","onUpdate:modelValue":e[9]||(e[9]=i=>a.observatii=i),disabled:t.saving},null,8,ja),[[D,a.observatii]]),l.observatii?(o(),c("div",Ia,m(l.observatii[0]),1)):h("",!0)]),n("div",Oa,[Va,I(n("input",{id:"km_bord",type:"number",class:"form-control",min:"0","onUpdate:modelValue":e[10]||(e[10]=i=>a.km_bord=i),disabled:t.saving},null,8,Ea),[[D,a.km_bord]]),l.km_bord?(o(),c("div",Ca,m(l.km_bord[0]),1)):h("",!0)]),n("div",Da,[n("button",{type:"submit",class:"btn btn-success btn-lg",disabled:t.saving},m(t.saving?"Se salvează...":"Salvează"),9,Na),n("button",{type:"button",class:"btn btn-outline-secondary btn-lg",disabled:t.saving,onClick:V}," Anulează ",8,La)])],40,Pe)])):h("",!0),n("section",Aa,[n("div",Fa,[Ba,C(v)?h("",!0):(o(),c("button",{key:0,type:"button",class:"btn btn-outline-primary btn-lg",onClick:O}," Adaugă cursă "))]),t.valabilitate.curse&&t.valabilitate.curse.length?(o(),c("div",Ua,[(o(!0),c(N,null,B(t.valabilitate.curse,i=>(o(),c("article",{key:i.id,class:"border rounded-4 p-3"},[n("div",za,[n("div",null,[n("p",Ma,m(i.incarcare_localitate)+" → "+m(i.descarcare_localitate),1),n("p",qa,m(_(i))+" · "+m(i.descarcare_tara??"Țară nedefinită"),1)]),n("div",Ra,[n("button",{type:"button",class:"btn btn-outline-secondary btn-lg",onClick:T=>L(i)}," Editează ",8,Ga),n("button",{type:"button",class:"btn btn-outline-danger btn-lg",onClick:T=>d(i)}," Șterge ",8,Pa)])]),i.observatii?(o(),c("div",Wa,m(i.observatii),1)):h("",!0)]))),128))])):(o(),c("div",Ja," Nu au fost adăugate curse pentru această valabilitate. "))])],64))]))}},Ka={class:"driver-app"},Xa={key:0,class:"alert alert-danger",role:"alert"},Qa={class:"row gy-4"},Ya={class:"col-12 col-lg-4"},Za={class:"col-12 col-lg-8"},ti={key:1,class:"alert alert-info",role:"status"},ei={__name:"DriverApp",props:{valabilitatiEndpoint:{type:String,required:!0},localitatiEndpoint:{type:String,required:!0},tari:{type:Array,default:()=>[]},romaniaId:{type:[Number,null],default:null},initialValabilitati:{type:Array,default:()=>[]}},setup(t){var E;const s=t,u=x(!1),a=x(!1),l=x(!1),f=x(""),b=x(k(s.initialValabilitati)),v=x(((E=b.value[0])==null?void 0:E.id)??null),p=x(null);st(()=>{v.value?g(v.value):S()}),q(()=>v.value,d=>{if(!d){p.value=null;return}g(d)});function k(d){return(d??[]).map(_=>({id:_.id,denumire:_.denumire,numar_auto:_.numar_auto,data_inceput:_.data_inceput??null,data_sfarsit:_.data_sfarsit??null,curse_count:_.curse_count??0}))}async function S(){var d;u.value=!0,f.value="";try{const _=await window.axios.get(s.valabilitatiEndpoint),r=((d=_==null?void 0:_.data)==null?void 0:d.valabilitati)??[];b.value=k(r),!v.value&&b.value.length>0&&(v.value=b.value[0].id)}catch(_){console.error(_),f.value="Nu am putut încărca lista de valabilități. Încercați din nou."}finally{u.value=!1}}async function g(d){var _;if(d){a.value=!0,f.value="";try{const r=await window.axios.get(`${s.valabilitatiEndpoint}/${d}`);$(((_=r==null?void 0:r.data)==null?void 0:_.valabilitate)??null)}catch(r){console.error(r),f.value="Nu am putut încărca detaliile valabilității selectate."}finally{a.value=!1}}}function $(d){if(!d){p.value=null;return}p.value=d,y(d)}function y(d){var e;const _={id:d.id,denumire:d.denumire,numar_auto:d.numar_auto,data_inceput:d.data_inceput,data_sfarsit:d.data_sfarsit,curse_count:d.curse_count??((e=d.curse)==null?void 0:e.length)??0},r=b.value.findIndex(i=>i.id===_.id);r===-1?b.value.push(_):b.value.splice(r,1,_)}function O(d){v.value!==d&&(v.value=d)}async function L(d){var _,r;if(p.value){l.value=!0;try{const e=await window.axios.post(`${s.valabilitatiEndpoint}/${p.value.id}/curse`,d);$(((_=e==null?void 0:e.data)==null?void 0:_.valabilitate)??null)}catch(e){throw((r=e==null?void 0:e.response)==null?void 0:r.status)===422?{type:"validation",errors:e.response.data.errors??{}}:(console.error(e),e)}finally{l.value=!1}}}async function V(d,_){var r,e;if(p.value){l.value=!0;try{const i=await window.axios.put(`${s.valabilitatiEndpoint}/${p.value.id}/curse/${d}`,_);$(((r=i==null?void 0:i.data)==null?void 0:r.valabilitate)??null)}catch(i){throw((e=i==null?void 0:i.response)==null?void 0:e.status)===422?{type:"validation",errors:i.response.data.errors??{}}:(console.error(i),i)}finally{l.value=!1}}}async function j(d){var _;if(p.value){l.value=!0;try{const r=await window.axios.delete(`${s.valabilitatiEndpoint}/${p.value.id}/curse/${d}`);$(((_=r==null?void 0:r.data)==null?void 0:_.valabilitate)??null)}catch(r){throw console.error(r),r}finally{l.value=!1}}}return(d,_)=>(o(),c("div",Ka,[f.value?(o(),c("div",Xa,m(f.value),1)):h("",!0),n("div",Qa,[n("div",Ya,[R(jt,{valabilitati:b.value,loading:u.value,"selected-id":v.value,onSelect:O,onRefresh:S},null,8,["valabilitati","loading","selected-id"])]),n("div",Za,[p.value?(o(),ot(Ha,{key:0,valabilitate:p.value,countries:t.tari,"romania-id":t.romaniaId,loading:a.value,saving:l.value,"create-cursa":L,"update-cursa":V,"delete-cursa":j,"localitati-endpoint":t.localitatiEndpoint},null,8,["valabilitate","countries","romania-id","loading","saving","localitati-endpoint"])):u.value?h("",!0):(o(),c("div",ti," Nu există valabilități active în acest moment. "))])])]))}},w=document.getElementById("driver-app");if(w){const t={valabilitatiEndpoint:w.dataset.valabilitatiEndpoint,localitatiEndpoint:w.dataset.localitatiEndpoint,tari:[],romaniaId:null,initialValabilitati:[]};if(w.dataset.tari)try{t.tari=JSON.parse(w.dataset.tari)}catch(s){console.error("Nu s-au putut încărca țările",s)}if(w.dataset.romaniaId){const s=parseInt(w.dataset.romaniaId,10);t.romaniaId=Number.isNaN(s)?null:s}if(w.dataset.initialValabilitati)try{t.initialValabilitati=JSON.parse(w.dataset.initialValabilitati)}catch(s){console.warn("Datele inițiale pentru valabilități nu au putut fi interpretate.",s)}ct(ei,t).mount(w)}
